<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Practical Faith Videos</title>
<script src="capacitor.js"></script>
</head>

<body style="margin:0; padding:0;">

<style>
/* Inline styles preserved when loaded into #content */
body {
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
}

.videos-wrapper {
  min-height: 100vh;
  padding-bottom: 140px;
  background: #ffb03b;
}

.videos-header {
  padding: 20px;
  text-align: center;
  background: linear-gradient(to bottom, #34495e, #2c3e50);
}

.videos-header h1 {
  margin: 0 0 8px 0;
  font-size: 28px;
  font-weight: 700;
  color: #ecf0f1;
}

.videos-header p {
  margin: 0;
  font-size: 16px;
  color: #bdc3c7;
}

/* Video Player */
.video-player-container {
  margin: 16px;
  background: #000;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.6);
  display: none;
}

.video-player-container.active {
  display: block;
}

.video-player {
  width: 100%;
  max-height: 60vh;
  background: #000;
}

.video-info {
  background: #34495e;
  padding: 16px;
}

.video-title {
  font-size: 18px;
  font-weight: 700;
  color: #ecf0f1;
  margin: 0 0 8px 0;
  line-height: 1.3;
}

.video-meta {
  font-size: 14px;
  color: #bdc3c7;
  margin: 0 0 8px 0;
}

.video-description {
  font-size: 14px;
  color: #95a5a6;
  margin: 0 0 12px 0;
  line-height: 1.4;
}

.share-button {
  background: #3498db;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  transition: background 0.2s;
}

.share-button:active {
  background: #2980b9;
}

.share-icon {
  font-size: 18px;
}

/* Placeholder when no video selected */
.video-placeholder {
  background: #34495e;
  padding: 60px 20px;
  text-align: center;
  border-radius: 12px;
  margin: 16px;
}

.video-placeholder-icon {
  font-size: 64px;
  margin-bottom: 16px;
}

.video-placeholder h2 {
  color: #ecf0f1;
  font-size: 20px;
  margin: 0 0 8px 0;
}

.video-placeholder p {
  color: #95a5a6;
  font-size: 15px;
  margin: 0;
}

/* Thumbnail Gallery */
.gallery-section {
  padding: 0 16px 20px 16px;
}

.gallery-title {
  font-size: 20px;
  font-weight: 700;
  color: #ecf0f1;
  margin: 0 0 16px 0;
  text-align: center;
}

.thumbnail-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.thumbnail-item {
  background: #34495e;
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0,0,0,0.4);
  transition: transform 0.2s, box-shadow 0.2s;
  border: 2px solid transparent;
  position: relative;
}

.thumbnail-item:active {
  transform: scale(0.98);
}

.thumbnail-item.playing {
  border: 2px solid #3498db;
  box-shadow: 0 4px 12px rgba(52, 152, 219, 0.6);
}

.thumbnail-image {
  width: 100%;
  height: 100px;
  object-fit: cover;
  background: #2c3e50;
  display: block;
}

.thumbnail-info {
  padding: 8px;
}

.thumbnail-title {
  font-size: 13px;
  font-weight: 600;
  color: #ecf0f1;
  margin: 0 0 4px 0;
  line-height: 1.2;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.thumbnail-date {
  font-size: 11px;
  color: #95a5a6;
  margin: 0 0 6px 0;
}

.thumbnail-share {
  background: #3498db;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
}

.thumbnail-share:active {
  background: #2980b9;
}

.loading {
  text-align: center;
  padding: 40px 20px;
  color: #ecf0f1;
  font-size: 16px;
}

.error {
  text-align: center;
  padding: 40px 20px;
  color: #e74c3c;
  font-size: 16px;
}
</style>

<div class="videos-wrapper">
  
  <div class="videos-header">
    <h1>Video Teachings</h1>
    <p>Select a video to watch</p>
  </div>

  <!-- Placeholder when no video selected -->
  <div class="video-placeholder" id="video-placeholder">
    <div class="video-placeholder-icon">ðŸŽ¬</div>
    <h2>Select a Video to Play</h2>
    <p>Tap any thumbnail below to start watching</p>
  </div>

  <!-- Video Player (hidden until video selected) -->
  <div class="video-player-container" id="player-container">
    <video id="video-player" class="video-player" controls controlsList="nodownload" preload="metadata">
      <source id="video-source" src="" type="video/mp4">
      Your browser does not support video playback.
    </video>
    
    <div class="video-info">
      <div class="video-title" id="current-title"></div>
      <div class="video-meta" id="current-meta"></div>
      <div class="video-description" id="current-description"></div>
      <button class="share-button" id="share-current-video">
        <span class="share-icon">â†—ï¸Ž</span>
        <span>Share This Teaching</span>
      </button>
    </div>
  </div>

  <!-- Thumbnail Gallery -->
  <div class="gallery-section">
    <div class="gallery-title">All Teachings</div>
    <div id="thumbnail-grid" class="thumbnail-grid">
      <div class="loading">Loading videos...</div>
    </div>
  </div>

</div>

<script>
(function() {
  let videos = [];
  let currentVideoIndex = -1;
  
  const videoPlayer = document.getElementById('video-player');
  const videoSource = document.getElementById('video-source');
  const playerContainer = document.getElementById('player-container');
  const videoPlaceholder = document.getElementById('video-placeholder');
  const currentTitle = document.getElementById('current-title');
  const currentMeta = document.getElementById('current-meta');
  const currentDescription = document.getElementById('current-description');
  const thumbnailGrid = document.getElementById('thumbnail-grid');
  const shareCurrentButton = document.getElementById('share-current-video');

  // Share functionality using Capacitor Share plugin
  async function shareVideo(video, index) {
    try {
      const { Share } = window.Capacitor.Plugins;
      
      if (!Share) {
        console.error('Share plugin not available');
        alert('Share feature not available');
        return;
      }

      await Share.share({
        title: video.title,
        text: `Check out this teaching: "${video.title}" from Practical Faith`,
        url: `https://practicalfaith.net/app/videos/${video.file}`,
        dialogTitle: 'Share Teaching'
      });
    } catch (error) {
      console.error('Error sharing:', error);
      // Don't show error if user cancelled
      if (error.message !== 'Share canceled') {
        alert('Unable to share at this time');
      }
    }
  }

  // Load videos from JSON
  async function loadVideos() {
    try {
      const response = await fetch('https://practicalfaith.net/app/videos/videos.json');
      if (!response.ok) throw new Error('Failed to load videos');
      
      videos = await response.json();
      renderThumbnails();
      
      // DO NOT auto-play - wait for user selection
    } catch (error) {
      console.error('Error loading videos:', error);
      thumbnailGrid.innerHTML = '<div class="error">Error loading videos. Please check your connection.</div>';
    }
  }

  // Render thumbnail grid
  function renderThumbnails() {
    if (videos.length === 0) {
      thumbnailGrid.innerHTML = '<div class="error">No videos available</div>';
      return;
    }

    thumbnailGrid.innerHTML = '';
    
    videos.forEach((video, index) => {
      const item = document.createElement('div');
      item.className = 'thumbnail-item';
      if (index === currentVideoIndex) {
        item.classList.add('playing');
      }
      
      item.innerHTML = `
        <img src="https://practicalfaith.net/app/videos/${video.thumb}" 
             alt="${video.title}" 
             class="thumbnail-image"
             onerror="this.style.display='none'">
        <div class="thumbnail-info">
          <div class="thumbnail-title">${video.title}</div>
          <div class="thumbnail-date">${video.date}</div>
          <button class="thumbnail-share" data-index="${index}">
            â†—ï¸Ž Share
          </button>
        </div>
      `;
      
      // Click thumbnail image to play
      const img = item.querySelector('.thumbnail-image');
      const titleDiv = item.querySelector('.thumbnail-title');
      img.addEventListener('click', () => playVideo(index));
      titleDiv.addEventListener('click', () => playVideo(index));
      
      // Click share button to share (prevent playing video)
      const shareBtn = item.querySelector('.thumbnail-share');
      shareBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        shareVideo(video, index);
      });
      
      thumbnailGrid.appendChild(item);
    });
  }

  // Play selected video
  function playVideo(index) {
    if (index < 0 || index >= videos.length) return;
    
    currentVideoIndex = index;
    const video = videos[index];
    
    // Hide placeholder, show player
    videoPlaceholder.style.display = 'none';
    playerContainer.classList.add('active');
    
    // Update video source
    videoSource.src = `https://practicalfaith.net/app/videos/${video.file}`;
    videoPlayer.load();
    
    // Update info
    currentTitle.textContent = video.title;
    currentMeta.textContent = video.date;
    currentDescription.textContent = video.description || '';
    
    // Update thumbnails to show current
    renderThumbnails();
    
    // Scroll to player
    playerContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    
    // Play video
    videoPlayer.play().catch(err => {
      console.error('Error playing video:', err);
    });
  }

  // Share current video button
  shareCurrentButton.addEventListener('click', () => {
    if (currentVideoIndex >= 0) {
      shareVideo(videos[currentVideoIndex], currentVideoIndex);
    }
  });

  // Auto-advance to next video when current finishes
  videoPlayer.addEventListener('ended', () => {
    if (currentVideoIndex < videos.length - 1) {
      playVideo(currentVideoIndex + 1);
    }
  });

  // Initialize
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadVideos);
  } else {
    loadVideos();
  }
})();
</script>

</body>
</html>
