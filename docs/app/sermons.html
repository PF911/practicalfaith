<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sermons & Teachings</title>
  <script src="capacitor.js"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f5f5;
      padding: 0;
      min-height: 100vh;
    }
    .container {
      padding: 16px;
      background: #f5f5f5;
      min-height: 100vh;
    }
    .header {
      margin-bottom: 20px;
    }
    .header h1 {
      margin: 0 0 8px 0;
      font-size: 28px;
      font-weight: 700;
      color: #000;
    }
    .header p {
      margin: 0;
      color: #666;
      font-size: 15px;
    }
    .teaching {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .teaching-title {
      font-weight: 600;
      font-size: 17px;
      margin: 0 0 8px 0;
      line-height: 1.3;
      color: #000;
    }
    .teaching-meta {
      font-size: 13px;
      color: #666;
      margin: 0 0 8px 0;
    }
    .teaching-desc {
      font-size: 14px;
      color: #333;
      margin: 0 0 12px 0;
      line-height: 1.4;
    }
    .platform-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 700;
      margin-right: 6px;
      background: #ff0000;
      color: white;
    }
    .buttons {
      display: flex;
      gap: 8px;
    }
    .btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .btn-watch {
      background: #007AFF;
      color: white;
    }
    .btn-save {
      background: #E5E5EA;
      color: #000;
    }
    .btn-save.saved {
      background: #34C759;
      color: white;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Sermons & Teachings</h1>
      <p>Watch and save for later</p>
    </div>

    <div id="teachings-list">
      <div class="loading">Loading teachings...</div>
    </div>
  </div>

  <script>
    (function() {
      const STORAGE_KEY = "pf_saved_teachings_v1";
      
      let teachings = [];
      let savedTeachings = [];
      let Preferences, Browser;

      // YouTube videos - UPDATE WITH YOUR REAL VIDEO IDs
      const youtubeVideos = [
        {
          title: "Learning to Let Go",
          platform: "YouTube",
          date: "January 12, 2026",
          url: "https://www.youtube.com/watch?v=u0DRlNpp4Wo",
          duration: "40:48",
          description: "Making the Bible Relevant for Today's Living"
        },
        {
          title: "When God Changes the Menu - A Message for the New Year",
          platform: "YouTube",
          date: "January 5, 2026",
          url: "https://www.youtube.com/watch?v=e8ZfqKCEgPM",
          duration: "35:22",
          description: "Starting the year with faith and purpose"
        },
        {
          title: "Walking in God's Light",
          platform: "YouTube",
          date: "December 22, 2025",
          url: "https://www.youtube.com/watch?v=EXAMPLE3",
          duration: "38:10",
          description: "Living as children of light"
        }
      ];

      function loadAllTeachings() {
        teachings = youtubeVideos;
        teachings.sort(function(a, b) {
          const dateA = new Date(a.date);
          const dateB = new Date(b.date);
          return dateB - dateA;
        });
        return true;
      }

      async function loadSavedTeachings() {
        try {
          if (Preferences) {
            const result = await Preferences.get({ key: STORAGE_KEY });
            savedTeachings = JSON.parse(result.value || "[]");
          }
        } catch (e) {
          console.error('Error loading saved:', e);
          savedTeachings = [];
        }
      }

      function isTeachingSaved(url) {
        return savedTeachings.some(function(t) { return t.url === url; });
      }

      async function saveTeaching(teaching) {
        try {
          if (isTeachingSaved(teaching.url)) {
            alert("This teaching is already saved!");
            return;
          }

          savedTeachings.unshift({
            id: String(Date.now()),
            title: teaching.title,
            url: teaching.url,
            source: teaching.platform,
            savedAt: new Date().toISOString()
          });

          if (Preferences) {
            await Preferences.set({
              key: STORAGE_KEY,
              value: JSON.stringify(savedTeachings)
            });
            alert("‚úì Saved! View in Saved Teachings.");
          } else {
            alert("Storage not available");
          }
          renderTeachings();
        } catch (e) {
          console.error('Save error:', e);
          alert("Error saving: " + e.message);
        }
      }

      async function openTeaching(url) {
        try {
          if (Browser) {
            await Browser.open({ url: url });
          } else {
            window.open(url, '_blank');
          }
        } catch (e) {
          console.error('Browser error:', e);
          window.open(url, '_blank');
        }
      }

      function renderTeachings() {
        const container = document.getElementById('teachings-list');
        
        if (teachings.length === 0) {
          container.innerHTML = '<div class="loading">No teachings found</div>';
          return;
        }

        container.innerHTML = '';
        
        teachings.forEach(function(teaching) {
          const saved = isTeachingSaved(teaching.url);
          const div = document.createElement('div');
          div.className = 'teaching';
          
          const descriptionHtml = teaching.description ? 
            '<div class="teaching-desc">' + teaching.description + '</div>' : '';
          
          div.innerHTML = 
            '<div class="teaching-title">' + teaching.title + '</div>' +
            '<div class="teaching-meta">' +
              '<span class="platform-badge">YouTube</span>' +
              teaching.date + ' ‚Ä¢ ' + teaching.duration +
            '</div>' +
            descriptionHtml +
            '<div class="buttons">' +
              '<button class="btn btn-watch">‚ñ∂Ô∏è Watch</button>' +
              '<button class="btn btn-save ' + (saved ? 'saved' : '') + '">' +
                (saved ? '‚úì Saved' : 'üíæ Save') +
              '</button>' +
            '</div>';
          
          const watchBtn = div.querySelector('.btn-watch');
          const saveBtn = div.querySelector('.btn-save');
          
          watchBtn.addEventListener('click', function() {
            openTeaching(teaching.url);
          });
          
          if (!saved) {
            saveBtn.addEventListener('click', function() {
              saveTeaching(teaching);
            });
          }
          
          container.appendChild(div);
        });
      }

      function initialize() {
        if (window.Capacitor && window.Capacitor.Plugins) {
          Preferences = window.Capacitor.Plugins.Preferences;
          Browser = window.Capacitor.Plugins.Browser;
        }
        
        loadSavedTeachings().then(function() {
          loadAllTeachings();
          renderTeachings();
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initialize);
      } else {
        setTimeout(initialize, 100);
      }
    })();
  </script>
</body>
</html>